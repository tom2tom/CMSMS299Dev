/*!
CMSMS filepicker widget v.1.1
(C) 2014-2022 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL3+
*/
!function($){$.widget("cmsms.filepicker",{options:{},_destroy:function(){this._settings.button.remove(),this._settings.iframe.remove(),this._settings.iframe=this._settings.container=this._settings.popup=this._settings.button=null,this.element.removeAttr("data-cmsms-i").removeAttr("readonly").removeClass("cmsfp cmsfp_elem")},_create:function(){if(!(this.element[0]instanceof HTMLInputElement))throw"filepicker: may only be applied to input elements";this._settings={};var t=this;if(void 0===this.options.start_path&&(this.options.start_path=cms_data.root_url),this._settings.btn_label=void 0!==this.options.btn_label?this.options.btn_label:cms_lang("choose")+"...",this._settings.button=$("<button />").text(this._settings.btn_label).addClass("adminsubmit cmsfp cmsfp_choose cmsfp-choose"),this.element.attr("readonly","readonly").addClass("cmsfp cmsfp_elem"),this.element.after(this._settings.button),this.element.after(" "),void 0!==this.options.required&&this.options.required)this.element.prop("required",!0);else{var s;s=this.options.remove_label?this.options.remove_label:void 0!==cms_data.lang_clear?cms_lang("clear"):"Clear";var e=this._settings.clear=$("<button />").text(s).addClass("adminsubmit cmsfp cmsfp_clear");this.options.remove_title&&e.attr("title",this.options.remove_title),this._settings.button.after(e),this._settings.button.after(" "),this.element.prop("required",!1)}if(this._settings.inst=this.element.attr("data-cmsfp-instance"),!this._settings.inst){var i=this._uniqid();this._settings.inst=i,this.element.attr("data-cmsfp-instance",i)}if(this._settings.url=this.options.url,!this._settings.url){if(void 0===cms_data.filepicker_url||!cms_data.filepicker_url)throw"No filepicker_url in the cms_data values-bank";this._settings.url=cms_data.filepicker_url}for(var n in this._settings.url+="&inst="+this._settings.inst,this.options)if(n.startsWith("param_")){var a=this.options[n];n=n.substr(6),this._settings.url+="&m1_"+n+"="+a}this.element.on("click",function(s){s.preventDefault(),t.open()}),this._settings.button.on("click",function(s){s.preventDefault(),t.open()}),this._settings.clear&&this._settings.clear.on("click",function(s){s.preventDefault(),t.element.val(""),t._about_clear(),t.element.trigger("change")}),this.element.on("cmsfp:change",function(s,e){t._setOption("value",e),t._about_clear(),t.close(),t.element.trigger("change")}),this.options.value?this._setOption("value",this.options.value):this.render()},_uniqid:function(){return"i"+(new Date).getTime().toString(36)},_about_clear:function(){this.element.val().length>0?this._settings.clear.show():this._settings.clear.hide()},_setOption:function(t,s){"value"===t&&this.element.val(s),this.render()},_create_popup:function(){if(!this._settings.container){this._settings.iframe=$("<iframe>").addClass("cmsfp cmsfp_frame").attr({src:this._settings.url,name:"x"+Date.now(),"data-cmsfp-inst":this._settings.inst});var t=this.options.title;t||(void 0!==cms_data.lang_select_file&&(t=cms_lang("select_file")),t||(t="Select a File")),this._settings.container=$("<div>").addClass("cmsfp cmsfp_dlg cmsms-fp_dlg").attr("title",t).append(this._settings.iframe),$("body",document).append(this._settings.container);var s=this,e=Math.min(window.innerWidth,600),i=Math.min(window.innerHeight,400);this._settings.popup=cms_dialog(this._settings.container,{autoOpen:!1,width:e,height:i,dialogClass:"cmsfp_dlg cmsms-fp_dlg",draggable:!0,resizable:!0,close:function(t,e){s.close()}})}},_relativePath:function(t,s){if(void 0===s&&(t.startsWith(cms_data.uploads_url)?s=cms_data.uploads_url:t.startsWith(cms_data.root_url)&&(s=cms_data.root_url)),t.startsWith(s)){var e=t.substr(s.length);return e.startsWith("/")&&(e=e.substr(1)),e}},render:function(){this._about_clear()},close:function(){cms_dialog(this._settings.popup,"destroy"),this._settings.container.remove(),this._settings.popup=null,this._settings.container=null},open:function(){this._create_popup(),cms_dialog(this._settings.popup,"open")},_noop:function(){}})}(jQuery);
