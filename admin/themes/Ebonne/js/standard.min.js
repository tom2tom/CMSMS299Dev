/*!
javascript for CMSMS Ebonne-theme v.0.9
(C) 2019-2022 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License: Affero GPL 3+
*/
var themejs={};(function($,t,i,e){var s,a,n,o=this,l=!1,c="themes/assets/js/js-cookie.min.js",u=null,r=null,d=[],h=0,p=6,f=25,m=.01,b=150,v=400,g=-1,y=40;this.init=function(){u=$("#ggp_menu");var e=$("#page_content");e.length>0?(r=e.find("div"),(e=$(".pagecontainer")).length>0&&e.css("overflow","hidden")):(r=$(".pagecontainer")).length>0?r.css("overflow","auto"):r=null,s=parseFloat(getComputedStyle(i.documentElement).fontSize),n=(a=s*y|0)+1,this.suckerSetup(u),this.migrateUIElements(),this.updateDisplay(),this.setupAlerts(),cms_data.alertfunc=this.popup_alert,cms_data.confirmfunc=this.popup_confirm,cms_data.promptfunc=this.popup_prompt,cms_data.dialogfunc=this.popup_dialog,cms_notify_all(),$('a[rel="external"]').attr("target","_blank"),$("input.defaultfocus, input[autofocus]").eq(0).focus(),this.isLocalStorage()||this.loadScript(c),$("#burger").on("click activate",function(t){u.toggleClass("hidden").find("ul").hide().css({visibility:"hidden"})}),$(t).on("resize",function(){l||(l=!0,o.updateDisplay(),setTimeout(function(){l=!1},200))}),cms_data.sitedown&&u.find('a[href^="logout.php"]').add($("#shortcuts").find('a[href^="logout.php"]')).on("click activate",function(t){t.preventDefault();var i=cms_lang("maintenance_warning");return cms_confirm_linkclick(this,i),!1})},this.loadScript=function(t,i,e){var s=!0,a=null;return"function"==typeof i?(a=i,s=e||s):(s=i||s,a=e||a),$('script').each(function(){return t!==$(this).attr("src")}),$.ajax(t,{dataType:"script",async:!1,cache:s}).done(a)},this.setParms=function(t){if(void 0!==t.cookiescript&&(c=t.cookiescript,this.isLocalStorage()||this.loadScript(c)),void 0!==t.viewwidth){var e=parseInt(t.viewwidth,10)||640,s=parseFloat(getComputedStyle(i.documentElement).fontSize);n=(a=(y=e/s|0)*s|0)+1}},this.setStorageValue=function(t,i,e){try{if(this.isLocalStorage()){var s;if(localStorage.removeItem(t),null!==e)s={value:i,timestamp:(new Date).getTime()+24*e*60*60*1e3};else s={value:i,timestamp:""};localStorage.setItem(t,JSON.stringify(s))}else{if(!this.isCookieScript())throw"No cookie storage!";null!==e?Cookies.set(t,i,{expires:e}):Cookies.set(t,i)}}catch(e){console.log("localStorage Error: set("+t+", "+i+")"),console.log(e)}},this.getStorageValue=function(t){var i;if(this.isLocalStorage()){var e=JSON.parse(localStorage.getItem(t));null!==e&&e.timestamp<(new Date).getTime()?this.removeStorageValue(t):null!==e&&(i=e.value)}else i=this.isCookieScript()?Cookies(t):"";return i},this.removeStorageValue=function(t){this.isLocalStorage()?localStorage.removeItem(t):this.isCookieScript()&&Cookies.remove(t)},this.isLocalStorage=function(){return"undefined"!=typeof Storage},this.isCookieScript=function(){return"undefined"!=typeof Cookies},this.isMobileDevice=function(){if("ontouchstart"in t||"ontouchstart"in i.documentElement||t.DocumentTouch&&i instanceof DocumentTouch||navigator.msMaxTouchPoints>0)return!0;if(t.matchMedia){var e=["("," -webkit- -moz- -o- -ms- ".split(" ").join("touch-enabled),("),"Z",")"].join("").replace(",(Z)","");return t.matchMedia(e).matches}return!1},this.toggleIndicator=function(t){var i,e=t[0].classList,s=["vshut","vopen","hshut","hopen"];for(i=0;i<4;i++)if(e.contains(s[i])){var a=i%2==0?i+1:i-1;return e.remove(s[i]),void e.add(s[a])}},this.overLi=function(t){0!=h&&(clearTimeout(h),h=0,$.each(d,function(t,i){o.toggleIndicator(i)}),d=[]);var i=$(t.target).closest("li");i.siblings().find("ul").hide().css({visibility:"hidden"}),i.hasClass("sub")&&i.find("ul ul").hide().css({visibility:"hidden"});var e,s,a=i.children("ul");if(a.length>0&&"hidden"==a.css("visibility"))if(i.hasClass("sub")){var n;$("#burger").is(":visible")?(s=0,n=g+20):i.hasClass("subsub")?(s=(e=i.parent("ul")[0].clientWidth)-6+"px",n=-1):i.hasClass("subsubL")?(s=-((e=i.parent("ul")[0].clientWidth)-21)+"px",n=-1):(s=0,n=g+20),a.css({left:s,top:n,visibility:"visible"}).animate({opacity:"show",height:"show"},b,"swing",function(){o.toggleIndicator(i)})}else{var l=i[0].getBoundingClientRect().right,c=i.find("li").eq(0),u=parseInt(c.css("width"),10),r=i.closest("div")[0].getBoundingClientRect().right;if(l+(e=parseInt(a.css("width"),10))+u<=r?i.hasClass("subsubL")&&i.removeClass("subsubL").addClass("subsub"):i.hasClass("subsub")&&i.removeClass("subsub").addClass("subsubL"),i.hasClass("subsub"))a.css({top:"-30px",visibility:"visible"}).animate({opacity:"show",width:"show"},b,"swing",function(){o.toggleIndicator(i)});else{var p=e+"px";s="-"+(e+3+20)+"px",a.css({left:0,width:0,top:"-1px",visibility:"visible"}).animate({opacity:"show",left:s,width:p},b,"swing",function(){o.toggleIndicator(i)})}}},this.outLi=function(t){0!=h&&(clearTimeout(h),$.each(d,function(t,i){o.toggleIndicator(i)}),d=[]);var i=$(t.target).closest("li");d.push(i),h=setTimeout(function(){u.find("ul").hide().css({visibility:"hidden"}),o.toggleIndicator(i);var t=d.indexOf(i);t>-1&&d.splice(t,1),h=0},v)},this.activateLi=function(t){0!=h&&(clearTimeout(h),h=0,$.each(d,function(t,i){o.toggleIndicator(i)}),d=[]);var i=$(t.target);if(i.is("a"))return!0;var e=i.closest("li");if(e.hasClass("descend")){var s=e.children("ul");return"hidden"==s.css("visibility")?o.overLi(t):(o.toggleIndicator(e),s.add(s.find("ul")).hide().css({visibility:"hidden"})),!1}},this.suckerSetup=function(t){var i=function(t,i){return Number(Math.round(t+"e"+i)+"e-"+i)};t.css({visibility:"hidden","flex-direction":"column"});var e=parseFloat(t.css("font-size")),s=i(e,1),a=t.children("li");a.css({visibility:"hidden",display:"block","white-space":"nowrap",width:""});var n=t[0].clientWidth;t.css("flex-direction","").data("menuwidth",n+"px"),a.css("visibility","visible").addClass("sub vshut").on("mouseover",o.overLi).on("mouseout",o.outLi).on("click activate",o.activateLi);var l=a.eq(-1);(a=a.find("> ul > li")).addClass("sub subsub").on("mouseover",o.overLi).on("mouseout",o.outLi).on("click activate",o.activateLi),l.find("> ul > li").removeClass("subsub").addClass("subsubL"),(a=a.find("li")).addClass("sub").on("mouseover",o.overLi).on("mouseout",o.outLi).on("click activate",o.activateLi);var c=t.find("ul");c.css({visibility:"hidden"}),c.each(function(){var t=$(this);g<0&&(e=(parseFloat(t.css("top"))+2)/s,g=i(e,2)+"em");var n=(a=t.children("li")).children(":not(ul)");a.css({visibility:"hidden","white-space":"nowrap"});var o=t.add(a).add(n).css({width:""}).end().end()[0].clientWidth;e=1.5+o/s,s<10&&(e+=.1),(e+=m)>f?e=f:e<p&&(e=p);var l=i(e,2)+"em";a.css({width:l,"white-space":"",visibility:"visible"}),t.css("width",l),t.parent().is("li.subsub")?(e=parseFloat(t.parent().parent().css("width"))/s,l=i(e+=.6,2)+"em"):l=t.parent().is("li.subsubL")?"-"+i(e-=.6,2)+"em":"0",t.data("wideleft",l)}),c.hide(),t.css("visibility",""),t.removeClass("noflash")},this.migrateUIElements=function(){$('input[type="submit"], :button[data-ui-icon]').each(function(){var t,i,e,s=$(this);s.hasClass("noautobtn")||s.hasClass("no-ui-btn")||!s.val().trim()||(t=s.is("[name*=submit]")?"iconcheck":s.is("[name*=apply]")?"iconapply":s.is("[name*=cancel]")||s.is("[name*=close]")?"iconclose":s.is("[name*=reset]")||"refresh"===s.attr("id")?"iconundo":"",i=s.is("input")?s.val():s.text(),e=$('<button type="submit" class="adminsubmit '+t+'">'+i+"</button>"),$(this.attributes).each(function(i,s){switch(s.name){case"type":break;case"class":var a=s.value.replace(/(^|\s*)ui-\S+/g,"");""!==a&&e.attr("class","adminsubmit "+t+" "+a);break;default:e.attr(s.name,s.value)}}),s.replaceWith(e))}),$(".pageback").addClass("link_button icon back")},this.updateDisplay=function(){var i=$(t).width(),e=u.hasClass("hidden");if(i<a){if(!e&&n>=a){u.addClass("hidden").find("#burger").show();var s=u.data("menuwidth");u.find("ul").each(function(){var t=$(this),i=t.parent();i.is("li.subsub")||i.is("li.subsubL")?(t.data("wideleft",t.css("left")),t.css({top:0,left:0})):t.css("left",s)}),u.find("li").off("mouseover",o.overLi).off("mouseout",o.outLi)}}else if(e){u.find("ul").each(function(){var t=$(this),i=t.parent();(i.is("li.subsub")||i.is("li.subsubL"))&&(t.css("left",t.data("wideleft")),t.css("top","3em"))}),u.find("#burger").hide(),u.removeClass("hidden"),u.find("li").on("mouseover",o.overLi).on("mouseout",o.outLi)}n=i},this.handleAlert=function(t){var i=$(t).closest(".alert-box"),e=i.data("alert-name");if(e)return $.ajax(cms_data.ajax_alerts_url,{method:"POST",data:{op:"delete",alert:e}}).fail(function(t,i,e){console.debug("problem deleting an alert: "+e)}).done(function(){i.slideUp(1e3),i.parent().children().length<=1&&(cms_dialog($("#alert-dialog"),"close"),$("#alert-noalerts").show(),$("#alerts").closest("li").remove()),i.remove()})},this.setupAlerts=function(){var t=this;$("#alerts").on("click activate",function(t){return t.preventDefault(),cms_dialog($("#alert-dialog")),!1}),$(".alert-remove, .alert-msg a").on("click activate",function(i){return i.preventDefault(),t.handleAlert(i.target),!1})},this.popup_alert=function(t,i,e){var s='<button type="button" class="adminsubmit">'+cms_lang("close")+"</button>";if(e)return $.fn.alertable.alert(t,{okButton:s});$.fn.alertable.alert(t,{okButton:s}).always()},this.popup_confirm=function(t,i,e,s){return $.fn.alertable.confirm(t,{okButton:'<button type="button" class="adminsubmit icon check">'+e+"</button>",cancelButton:'<button type="button" class="adminsubmit icon cancel">'+s+"</button>"})},this.popup_prompt=function(t,i,e){return $.fn.alertable.prompt(t,{prompt:'<input type="text" class="alertable-input" value="'+i+'">',okButton:'<button type="button" class="adminsubmit icon check">'+cms_lang("ok")+"</button>",cancelButton:'<button type="button" class="adminsubmit icon cancel">'+cms_lang("cancel")+"</button>"})},this.popup_dialog=function(t,i){return(i=i||{}).classes=$.extend(i.classes||{},{"ui-dialog":"alertable","ui-dialog-title":"alertable-message","ui-dialog-buttonpane":"alertable-buttons","ui-dialog-buttonset":"alertable-buttons"}),t.dialog(i)},this.aboutToggle=function(){var t=i.getElementById("aboutinfo");"none"===t.style.display?t.style.display="inline-block":t.style.display="none"}}).call(themejs,jQuery,window,document,"themejs"),$(function(){themejs.init()});
