/*!
CMSMS OneEleven theme functions v.1.2
(C) 2014-2023 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL3+
*/
!function(e,$){"use strict";var t=e.OE={};$(function(){t.helper.init(),t.view.init()}),t.helper={init:function(){$("a[rel=external]").attr("target","_blank"),$("input.defaultfocus, input[autofocus]").eq(0).trigger("focus"),this._isLocalStorage()||this.loadScript("themes/assets/js/js-cookie.min.js")},loadScript:function(e,t,n){var o=!0,a=null;return"function"==typeof t?(a=t,o=n||o):(o=t||o,a=n||a),$('script[type="text/javascript"]').each(function(){return e!==$(this).attr("src")}),$.ajax(e,{dataType:"script",async:!1,cache:o}).done(a).fail(function(e,t,n){console.debug("AJAX error: "+n)})},setStorageValue:function(e,t,n){var o=(new Date).getTime()+24*n*60*60*1e3,a={};try{!0===this._isLocalStorage()?(localStorage.removeItem(e),a=null!==n?{value:t,timestamp:o}:{value:t,timestamp:""},localStorage.setItem(e,JSON.stringify(a))):"undefined"!=typeof Cookies&&(null!==n?Cookies.set(e,t,{expires:n}):Cookies.set(e,t))}catch(n){console.log("localStorage Error: set("+e+", "+t+")"),console.log(n)}},getStorageValue:function(e){var t,n="";return this._isLocalStorage()?null!==(n=JSON.parse(localStorage.getItem(e)))&&n.timestamp<(new Date).getTime()?this.removeStorageValue(e):null!==n&&(t=n.value):"undefined"!=typeof Cookies&&(t=Cookies(e)),t},removeStorageValue:function(e){this._isLocalStorage()?localStorage.removeItem(e):"undefined"!=typeof Cookies&&Cookies.remove(e)},equalHeight:function(e){var t=0;e.each(function(){var e=$(this).height();e>t&&(t=e)}),e.height(t)},_isLocalStorage:function(){return"undefined"!=typeof Storage},_isMobileDevice:function(){if(navigator.userAgent.toLowerCase().match(/(Android|iPhone|iPad|iPod|Blackberry|Dolphin|IEMobile|WPhone|Windows Mobile|IEMobile9||IEMobile10||IEMobile11|Kindle|Mobile|MMP|MIDP|Pocket|PSP|Symbian|Smartphone|Sreo|Up.Browser|Up.Link|Vodafone|WAP|Opera Mini|Opera Tablet|Mobile|Fennec)/i)&&("ontouchstart"in window||navigator.msMaxTouchPoints>0||window.DocumentTouch&&document instanceof DocumentTouch))return!0}},t.view={init:function(){var e=this,t=!1,n=$("#oe_sidebar > aside"),o=n.find(".toggle-button"),a=$("#oe_container"),i=$("#oe_pagemenu");n.on("click",function(t){t.preventDefault(),o.is(":visible")&&(a.hasClass("sidebar-on")?e._closeSidebar(a,i):e._showSidebar(a,i))}),e.toggleSubMenu(i,50),e.showNotifications(),e.setUIButtons(),e.setupAlerts(),e.updateDisplay(),e.handleSidebar(a),cms_data.sitedown&&$(".outwarn").on("click activate",function(e){e.preventDefault();var t=cms_lang("maintenance_warning");return cms_confirm_linkclick(this,t),!1}),$(window).on("resize",function(){if(!t){t=!0;var n=.01*this.innerHeight,o=.01*this.innerWidth;document.documentElement.style.setProperty("--vh",n+"px","important"),document.documentElement.style.setProperty("--vw",o+"px","important"),e.handleSidebar(a),e.updateDisplay(),setTimeout(function(){t=!1},100)}})},handleSidebar:function(e){var n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;"sidebar-off"===t.helper.getStorageValue("sidebar-pref")||n<=768?e.addClass("sidebar-off").removeClass("sidebar-on"):e.addClass("sidebar-on").removeClass("sidebar-off")},toggleSubMenu:function(e,t){var n=this;e.find("> li > span").on("click",function(o){o.preventDefault();var a=$(this),i=a.hasClass("open-sub"),s=a.next(),r=[];return 0!==s.length&&"hidden"!==s.css("visibility")&&"none"!==s.css("display")||r.push(e.find("ul").slideUp(t)),e.find(".nav").removeClass("current").find("span").removeClass("open-sub"),a.parent(".nav").addClass("current"),i?r.push(s.slideToggle(t)):a.addClass("open-sub"),$.when.apply($,r).done(function(){n.updateDisplay()}),!1})},showNotifications:function(){if("function"!=typeof cms_notify_all){$(".pagewarning, .message, .pageerrorcontainer, .pagemcontainer").prepend('<span class="close-warning"></span>'),$(document).on("click",".close-warning",function(){$(this).parent().hide(),$(this).parent().remove()});var e=$("body").attr("id")+"_notification";$(".pagewarning .close-warning").on("click",function(){t.helper.setStorageValue(e,"hidden",60)}),"hidden"===t.helper.getStorageValue(e)&&$(".pagewarning").addClass("hidden"),$(".message:not(.no-slide)").on("click",function(){$(".message").slideUp()}),$(".message:not(.no-slide), .pageerrorcontainer:not(.no-slide), .pagemcontainer:not(.no-slide)").each(function(){var e=$(this);$(e).hide().slideDown(1e3,function(){window.setTimeout(function(){e.slideUp()},1e4)})}),$(document).on("cms_ajax_apply",function(e){var t,n=$("button[name=cancel], button[name=m1_cancel]"),o=cms_lang("close");n.length>0&&n.fadeOut().button("option","label",e.close).fadeIn(),t="Success"===e.response?'<aside class="message pagemcontainer" role="status"><span class="close-warning">'+o+'</span><p class="pagemessage">'+e.details+"</p></aside>":'<aside class="message pageerrorcontainer" role="alert"><span class="close-warning">'+o+'</span><ul class="pageerror">'+e.details+"</ul></aside>",$("body").append(t).slideDown(1e3,function(){window.setTimeout(function(){$(".message").slideUp().remove()},1e4)}),$(document).on("click",".close-warning",function(){$(".message").slideUp().remove()})})}else cms_notify_all()},setUIButtons:function(){$("input[type=submit], :button[data-ui-icon]").each(function(){if(!this.value.trim())return!0;var e=$(this),t=e.data("uiIcon")||"ui-icon-circle-check",n=e.val(),o=$("<button />");e.hasClass("noautobtn")&&e.hasClass("no-ui-btn")||(e.is("[name*=apply]")?t=e.data("uiIcon")||"ui-icon-disk":e.is("[name*=cancel]")?t=e.data("uiIcon")||"ui-icon-circle-close":(e.is("[name*=resettodefault]")||"refresh"===e.attr("id"))&&(t=e.data("uiIcon")||"ui-icon-refresh")),e.is(":button")&&(n=e.text()),$(this.attributes).each(function(e,t){o.attr(t.name,t.value)}),o.button({icons:{primary:t},label:n}),e.replaceWith(o)}),$("a.pageback").addClass("ui-state-default ui-corner-all").prepend('<span class="ui-icon ui-icon-arrowreturnthick-1-w">').hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})},updateDisplay:function(){var e=$("#oe_menu"),t=$("#admin-alerts"),n=$("header.header"),o=n.outerHeight()+n.offset().top;t.length&&(o=t.outerHeight()+t.offset().top),e.outerHeight()+o<$(window).height()?e.css({position:"fixed",top:o}):(e.css({position:"",top:""}),e.offset().top<$(window).scrollTop()&&$("html, body").animate({scrollTop:$("#oe_menu").offset().top},1e3))},_showSidebar:function(e,n){e.addClass("sidebar-on").removeClass("sidebar-off"),n.find("li.current ul").show(),t.helper.setStorageValue("sidebar-pref","sidebar-on",60)},_closeSidebar:function(e,n){e.removeClass("sidebar-on").addClass("sidebar-off"),n.find("li ul").hide(),t.helper.setStorageValue("sidebar-pref","sidebar-off",60)},_handleAlert:function(e){var t=$(e).closest(".alert-box"),n=t.data("alert-name");if(n)return $.ajax({method:"POST",url:cms_data.ajax_alerts_url,data:{op:"delete",alert:n}}).done(function(){t.slideUp(1e3),t.parent().children().length<=1&&(t.closest("div.ui-dialog-content").dialog("close"),$("#alert-noalerts").show(),$("a#alerts").closest("li").remove()),t.remove()}).fail(function(e,t,n){console.debug("problem deleting an alert: "+n)})},setupAlerts:function(){var e=this;$("a#alerts").on("click",function(e){e.preventDefault(),$("#alert-dialog").dialog()}),$(".alert-msg a,.alert-icon,.alert-remove").on("click",function(t){t.preventDefault(),e._handleAlert(t.target)})}},t.aboutToggle=function(){var e=document.getElementById("aboutinfo");"none"===e.style.display?e.style.display="inline-block":e.style.display="none"}}(this,jQuery);