/*!
jQuery autoRefresh widget v.1.2
(C) 2014-2022 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL3+
*/
!function($,t,e,s){$.widget("cmsms.autoRefresh",{options:{url:null,data:null,interval:30,start_handler:null,done_handler:null},settings:{timer:null,focus:-1,lastrefresh:null},_create:function(){if(!this.options.url)throw"An URL must be specified for the autoRefresh widget";var t=this.options.interval;if(t<1||t>3600)throw"The autoRefresh widget refresh-interval must be in the range 1 to 3600";var s=this;return e.contains(this.element[0])&&this.element.find(":input,a").on("click",function(){s.reset()}),$(e).on("focus",function(){s.settings.focus<1&&(s.settings.focus=1,s.reset())}),$(e).on("blur",function(){1===s.settings.focus&&(s.settings.focus=0,s.stop())}),this.reset(),this.refresh(),this.element},_setOption:function(t,e){switch(t){case"url":if("string"==typeof e&&e.length>0)return this.options.url=e,this.reset(),this.refresh();this.stop();break;case"data":return this.options.data=e,this.reset(),this.refresh();case"interval":var s=parseInt(e);if(s>0)return this.options.interval=Math.min(s,3600),this.reset(),this.refresh();this.stop();break;case"start_handler":this.options.start_handler="function"==typeof e?e:null;break;case"done_handler":this.options.done_handler="function"==typeof e?e:null}},stop:function(){this.settings.timer&&(clearInterval(this.settings.timer),this.settings.timer=null)},start:function(){this.reset()},reset:function(){if(this.stop(),!(this.options.interval<1)){var t=this;this.settings.timer=setInterval(function(){t.refresh()},1e3*this.options.interval)}},refresh:function(){if(this.settings.focus){var t=Date.now()/1e3;this.settings.lastrefresh=t,"function"==typeof this.options.start_handler&&this.options.start_handler(),cms_busy();var s=this;return $.ajax(this.options.url,{data:this.options.data,cache:!1}).fail(function(t,e,n){console.debug("ajax call to "+s.options.url+" failed: "+n)}).done(function(t){e.contains(s.element[0])&&s.element.html(t),"function"==typeof s.options.done_handler&&s.options.done_handler(t)}).always(function(){cms_busy(!1)})}}})}(jQuery,window,document);