/*!
CMSMS Altbier theme functions v.2
(C) 2018-2022 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL2+
*/
!function(e,$,t,a){"use strict";e.AB={show_submenus:!1,init:function(){var e=this,a=!1,n=$("#ab_container"),i=$("#ab_pagemenu");this.isLocalStorage()||this.loadScript("themes/assets/js/js-cookie.min.js"),this.toggleSubMenu(i,50),this.setUIButtons(),this.updateDisplay(),this.handleSidebar(n),this.setupAlerts(),cms_notify_all(),$('a[rel="external"]').attr("target","_blank"),cms_data.sitedown&&$(".outwarn").on("click activate",function(e){e.preventDefault();var t=cms_lang("maintenance_warning");return cms_confirm_linkclick(this,t),!1}),$(t).on("resize",function(){a||(a=!0,e.handleSidebar(n),e.updateDisplay(),setTimeout(function(){a=!1},200))}),$("#toggle-button").on("click activate",function(t){return t.preventDefault(),n.hasClass("sidebar-on")?(e.closeSidebar(n,i),e.show_submenus=!1):(e.show_submenus=!0,e.openSidebar(n,i)),!1}),$("input.defaultfocus, input[autofocus]").eq(0).focus()},loadScript:function(e,t,a){var n=!0,i=null;return"function"==typeof t?(i=t,n=a||n):(n=t||n,i=a||i),$('script[type="text/javascript"]').each(function(){return e!==$(this).attr("src")}),$.ajax(e,{dataType:"script",async:!1,cache:n}).done(i)},setStorageValue:function(e,t,a){var n=(new Date).getTime()+24*a*60*60*1e3,i={};try{!0===this.isLocalStorage()?(localStorage.removeItem(e),i=null!==a?{value:t,timestamp:n}:{value:t,timestamp:""},localStorage.setItem(e,JSON.stringify(i))):"undefined"!=typeof Cookies&&(null!==a?Cookies.set(e,t,{expires:a}):Cookies.set(e,t))}catch(a){console.log("localStorage Error: set("+e+", "+t+")"),console.log(a)}},getStorageValue:function(e){var t,a="";return this.isLocalStorage()?null!==(a=JSON.parse(localStorage.getItem(e)))&&a.timestamp<(new Date).getTime()?this.removeStorageValue(e):null!==a&&(t=a.value):"undefined"!=typeof Cookies&&(t=Cookies(e)),t},removeStorageValue:function(e){this.isLocalStorage()?localStorage.removeItem(e):"undefined"!=typeof Cookies&&Cookies.remove(e)},isLocalStorage:function(){return"undefined"!=typeof Storage},isMobileDevice:function(){if(navigator.userAgent.toLowerCase().match(/(Android|iPhone|iPad|iPod|Blackberry|Dolphin|IEMobile|WPhone|Windows Mobile|IEMobile9||IEMobile10||IEMobile11|Kindle|Mobile|MMP|MIDP|Pocket|PSP|Symbian|Smartphone|Sreo|Up.Browser|Up.Link|Vodafone|WAP|Opera Mini|Opera Tablet|Mobile|Fennec)/i)&&("ontouchstart"in t||navigator.msMaxTouchPoints>0||t.DocumentTouch&&a instanceof DocumentTouch))return!0},aboutToggle:function(){var e=a.getElementById("aboutinfo");"none"===e.style.display?e.style.display="inline-block":e.style.display="none"},equalHeight:function(e){var t=0;e.each(function(){var e=$(this).height();e>t&&(t=e)}),e.height(t)},updateDisplay:function(){var e,a=$("#ab_menu"),n=$("#admin-alerts");if(n.length)e=n.outerHeight()+n.offset().top;else{var i=$("#header");e=i.outerHeight()+i.offset().top}a.outerHeight()+e<$(t).height()||a.offset().top<$(t).scrollTop()&&$("html, body").animate({scrollTop:$("#ab_menu").offset().top},1e3)},handleSidebar:function(e){var a=$(t).outerWidth();"sidebar-off"===this.getStorageValue("sidebar-pref")||a<=767?(e.addClass("sidebar-off").removeClass("sidebar-on"),this.show_submenus=!1):(e.addClass("sidebar-on").removeClass("sidebar-off"),this.show_submenus=!0)},openSidebar:function(e,t){this.show_submenus=!0;var a=t.find("li.current");a.length>0&&(a=a.parentsUntil(t,"ul").add(a.children("ul"))).show(),e.addClass("sidebar-on").removeClass("sidebar-off"),this.setStorageValue("sidebar-pref","sidebar-on",60)},closeSidebar:function(e,t){e.removeClass("sidebar-on").addClass("sidebar-off"),t.find("li ul").hide(),this.show_submenus=!1,this.setStorageValue("sidebar-pref","sidebar-off",60)},toggleSubMenu:function(e,t){var a=this,n=e.find("li.sub");n.children("a").on("click activate",function(t){var n=$(this).parent();return n.hasClass("current")?(t.preventDefault(),!1):(e.find("li").removeClass("current open").find(".nav-mark").removeClass("open"),n.addClass("current"),a.closeSidebar($("#ab_container"),e),a.updateDisplay(),!0)}),n.children("span").on("click activate",function(e){e.preventDefault();var n=$(this).parent(),i=[];if(n.hasClass("open"))i.push(n.find("ul").slideUp(t)),i.push(n.add(n.find("li")).removeClass("open").find(".nav-mark").removeClass("open"));else{var o=n.siblings();i.push(o.find("ul").slideUp(t/2)),i.push(o.add(o.find("li")).removeClass("open").find(".nav-mark").removeClass("open")),i.push(n.children("ul").slideDown(t)),i.push(n.addClass("open").children(".nav-mark").addClass("open"))}return $.when.apply($,i).done(function(){a.updateDisplay()}),!1})},setUIButtons:function(){$('input[type="submit"], :button[data-ui-icon]').each(function(){if(!this.value.trim())return!0;var e=$(this),t=e.data("uiIcon")||"ui-icon-circle-check",a=e.val(),n=$("<button>");e.hasClass("noautobtn")&&e.hasClass("no-ui-btn")||(e.is("[name*=apply]")?t=e.data("uiIcon")||"ui-icon-disk":e.is("[name*=cancel]")?t=e.data("uiIcon")||"ui-icon-circle-close":(e.is("[name*=resettodefault]")||"refresh"===e.attr("id"))&&(t=e.data("uiIcon")||"ui-icon-refresh")),e.is(":button")&&(a=e.text()),$(this.attributes).each(function(e,t){n.attr(t.name,t.value)}),n.button({icons:{primary:t},label:a}),e.replaceWith(n)}),$(".pageback").addClass("ui-state-default ui-corner-all").prepend('<span class="ui-icon ui-icon-arrowreturnthick-1-w">').hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})},handleAlert:function(e){var t=$(e).closest(".alert-box"),a=t.data("alert-name");if(a)return $.ajax(cms_data.ajax_alerts_url,{method:"POST",data:{op:"delete",alert:a}}).fail(function(e,t,a){console.debug("problem deleting an alert: "+a)}).done(function(){t.slideUp(1e3),t.parent().children().length<=1&&(cms_dialog($("#alert-dialog"),"close"),$("#alert-noalerts").show(),$("#alerts").closest("li").remove()),t.remove()})},setupAlerts:function(){var e=this;$("#alerts").on("click activate",function(e){e.preventDefault(),cms_dialog($("#alert-dialog"))}),$(".alert-remove, .alert-msg a").on("click activate",function(t){t.preventDefault(),e.handleAlert(t.target)})}}}(this,jQuery,window,document),$(function(){AB.init()});
