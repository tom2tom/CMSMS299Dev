/*!
jQuery Resize And Crop (jrac) plugin V.1.0.3 <https://github.com/trepmag/jrac>
(C) 2011-2014 Cedric Gampert <cgampert@gmail.com>
License: GPL2
*/
!function($){$.fn.jrac=function(i){var t=$.fn.jrac.defaults;return this.each(function(){if($(this).is("img")){var o=t,e=!1;"object"==typeof i?o=$.extend({},o,i):"destroy"===i&&(e=!0);var r=$(this),a=!1;if(r.parent().hasClass("jrac_viewport")&&(a=!0),a&&e?(r.draggable("destroy"),r.parent().find(".jrac_crop").remove(),r.parent().parent().find(".jrac_zoom_slider").remove(),r.parent().append(r.data("original")),r.parent().unwrap(),r.unwrap(),r.remove()):r.data("original",r.clone()),!e){a||r.hide().css("position","absolute").wrap('<div class="jrac_container"><div class="jrac_viewport"></div></div>');var n=r.parent(),s=n.parent(),_=$('<div class="jrac_loading" />');n.append(_);var c=function(){var i,t;if($.extend(r,{scale_proportion_locked:!0,originalWidth:r.width(),originalHeight:r.height()}),r.width(o.image_width).height(o.image_height),o.viewport_image_surrounding?n.width(r.width()).height(r.height()):n.width(o.viewport_width).height(o.viewport_height),r.css({left:o.viewport_content_left,top:o.viewport_content_top}),a)i=s.find("div.jrac_zoom_slider"),t=n.find("div.jrac_crop");else{if(o.zoom_label){var e=$('<div class="jrac_zoom_slider_label">'+o.zoom_label+"</div>");s.append(e)}i=$('<div class="jrac_zoom_slider"><div class="ui-slider-handle"></div></div>').slider({value:r.width(),min:o.zoom_min,max:o.zoom_max,start:function(t,o){$.extend(i,{on_start_width_value:o.value,on_start_height_value:r.height()})},slide:function(t,o){var e=Math.round(i.on_start_height_value*o.value/i.on_start_width_value);r.height(e),r.width(o.value),n.observator.notify("jrac_image_height",e),n.observator.notify("jrac_image_width",o.value)}}),s.append(i),o.viewport_resize&&n.resizable(),r.draggable({drag:function(i,t){t.position.left!=t.originalPosition.left&&n.observator.notify("jrac_crop_x",n.observator.crop_position_x()),t.position.top!=t.originalPosition.top&&n.observator.notify("jrac_crop_y",n.observator.crop_position_y())}}),t=$('<div class="jrac_crop"><div class="jrac_crop_drag_handler"></div></div>').css({width:o.crop_width,height:o.crop_height,left:o.crop_x+o.viewport_content_left,top:o.crop_y+o.viewport_content_top}).draggable({containment:n,handle:"div.jrac_crop_drag_handler",drag:function(i,t){t.position.left!=t.originalPosition.left&&n.observator.notify("jrac_crop_x",n.observator.crop_position_x()),t.position.top!=t.originalPosition.top&&n.observator.notify("jrac_crop_y",n.observator.crop_position_y())}}),o.crop_resize&&t.resizable({containment:n,aspectRatio:o.crop_aspect_ratio,resize:function(i,o){o.size.width!=o.originalSize.width&&n.observator.notify("jrac_crop_width",t.width()),o.size.height!=o.originalSize.height&&n.observator.notify("jrac_crop_height",t.height())}}),n.append(t)}$.extend(n,{$container:s,$image:r,$crop:t,$zoom_widget:i,observator:{items:{},register:function(i,t,o){i&&t&&(this.items[i]={element:t,callback:o})},unregister:function(i){delete this.items[i]},notify:function(i,t){if(this.items[i]){var o=this.items[i].element,e=this.items[i].callback;o.trigger(i,[n,t]),$.isFunction(e)&&e.call(n,i,o,t)}r.trigger("jrac_events",[n])},notify_all:function(){this.notify("jrac_crop_x",this.crop_position_x()),this.notify("jrac_crop_y",this.crop_position_y()),this.notify("jrac_crop_width",t.width()),this.notify("jrac_crop_height",t.height()),this.notify("jrac_image_width",r.width()),this.notify("jrac_image_height",r.height())},crop_position_x:function(){return t.position().left-r.position().left},crop_position_y:function(){return t.position().top-r.position().top},crop_consistent:function(){return this.crop_position_x()>=0&&this.crop_position_y()>=0&&this.crop_position_x()+t.width()+2*parseInt(t.css("border-width"),10)<=r.width()&&this.crop_position_y()+t.height()+2*parseInt(t.css("border-width"),10)<=r.height()},set_property:function(o,e){if(e=parseInt(e),!isNaN(e)){switch(o){case"jrac_crop_x":t.css("left",e+r.position().left);break;case"jrac_crop_y":t.css("top",e+r.position().top);break;case"jrac_crop_width":t.width(e);break;case"jrac_crop_height":t.height(e);break;case"jrac_image_width":if(r.scale_proportion_locked){var a=Math.round(r.height()*e/r.width());r.height(a),this.notify("jrac_image_height",a)}r.width(e),i.slider("value",e);break;case"jrac_image_height":if(r.scale_proportion_locked){var n=Math.round(r.width()*e/r.height());r.width(n),this.notify("jrac_image_width",n),i.slider("value",n)}r.height(e)}this.notify(o,e)}}}}),_.hide(),_.remove(),r.show(),"function"==typeof o.viewport_onload&&(o.viewport_onload.call(n),n.observator.notify_all())},h=r.attr("src");/^data:image/.test(h)?c():(h=h+(h.search(/\?/)<0?"?":"&")+"jracrandom="+(new Date).getTime(),$("<img/>").attr("src",h).load(c))}}})},$.fn.jrac.defaults=$.extend({},{crop_width:200,crop_height:100,crop_x:0,crop_y:0,crop_resize:!0,crop_aspect_ratio:null,image_width:null,image_height:null,zoom_min:100,zoom_max:3e3,zoom_label:"",viewport_image_surrounding:!1,viewport_width:null,viewport_height:null,viewport_resize:!0,viewport_content_left:0,viewport_content_top:0,viewport_onload:null},$.fn.jrac.defaults||{})}(jQuery);