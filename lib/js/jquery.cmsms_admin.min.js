/*!
CMSMS admin functions
(C) 2014-2020 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL2+
*/
var CMSMS_Admin=CMSMS_Admin||{};if(function(t,e){"use strict";for(var i,n=function(){},o=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],s=o.length,c=t.console=t.console||{};s--;)c[i=o[s]]||(c[i]=n);this.namespace=function(t){var i,n,o,s=t.split("."),c=CMSMS_Admin;for(s[0]===e&&(s=s.slice(1)),i=0,n=s.length;i<n;i++)void 0===c[o=s[i]]&&(c[o]={}),c=c[o];return c}}.call(CMSMS_Admin,window,"CMSMS_Admin"),function($){"use strict";var t=CMSMS_Admin.namespace("Helper");t.cms_uploadLimit=function(){$("form").on("submit",function(t){if(!$(this).attr("novalidate")){var e=$('input[type="file"]',this);if(0!==e.length){var i=0;return e.each(function(t,e){0!==e.files.length&&(i+=e.files[0].size)}),void 0!==cms_data&&void 0!==cms_data.max_upload_size&&cms_data.max_upload_size>0&&i>cms_data.max_upload_size?(cms_alert(cms_lang("largeupload")),!1):void 0}}})},t.cms_resizableTextArea=function(){var t=document.createElement("textarea");$("textarea").each(function(){var e=$(this);void 0!==t.style.resize&&!e.hasClass("cms_resizable")||e.hasClass("MicroTiny")||e.hasClass("no-resize")||e.resizable({handles:"se",ghost:!0})})},t.cms_helpDialog=function(){$(".cms_help .cms_helpicon").on("click",function(){activateHelp(this)})},t.cms_initTabs=function(){function t(t){var e=$("#navt_tabs");0===e.length&&(e=$("#page_tabs")),e.find("div").eq(t).trigger("mousedown")}var e=$("#navt_tabs, #page_tabs").find("div");e.on("mousedown",function(){var t=$(this);return e.each(function(){var t=$(this);t.removeClass("active"),$("#"+t.attr("id")+"_c").hide()}),t.addClass("active"),$("#"+t.attr("id")+"_c").show(),!0}),e.on("focus",function(t){$(this).addClass("focus")}),e.on("blur",function(t){$(this).removeClass("focus")}),e.on("keyup",function(i){i.keyCode==$.ui.keyCode.ENTER&&t(e.index(this))}),e.attr("tabindex","0"),0===e.filter(".active").mousedown().length&&t(0)},t.cms_initModalDialog=function(){var t={};$(".dialog").each(function(){var e=$(this),i=$(this).prev(".open").attr("title");t[i]=cms_dialog(e,{autoOpen:!1,modal:!0})}),$(".open").on("click",function(e){e.preventDefault();var i=$(this).attr("title");return t[i].dialog("open").removeClass("invisible"),!1})},t.cms_initTooltips=function(){$(".tooltip").tooltip({items:"[title], [data-cms-description], [data-cms-ajax]",content:function(t){var e,i=$(this),n=i.data();return i.is("[data-cms-description]")?n.cmsDescription:i.is("[data-cms-ajax]")?(e=n.cmsAjax+"&"+cms_data.job_key+"=1",$.ajax(e,{dataType:"html"}).fail(function(t,e,i){console.debug("Request error: "+e+" "+i)}).done(function(e){t(e)})):i.is("[title]")?i.attr("title"):void 0}})},t.cms_jquiMarkup=function(){$("[data-jqui]").each(function(t,e){var i=$(e).data();$.each(i.jqui.split(/\s+/),function(t,n){$(e)[n](i)})})};var e=CMSMS_Admin.namespace("Loader");e.reload=function(){},e.init=function(){e.reload(),t.cms_resizableTextArea(),t.cms_helpDialog(),t.cms_initTabs(),t.cms_initModalDialog(),t.cms_initTooltips(),t.cms_uploadLimit()},$(function(){e.init(),$(document).on("cms_ajax_apply",function(t){cms_notify("Success"===t.response?"success":"error",t.details)})});var i="cmsms_checkall",n={target:"table"};function o(t,e){this.element=t,this.settings=$.extend({},n,e),this.defaults=n,this._name=i,this.init()}o.prototype={init:function(){this._toggle(this.element,this.settings.target)},_toggle:function(t,e){var i=$(t).closest(e),n=$(t);$('[type="checkbox"]',i).not(n).on("click",function(){var t=$(this),e=t.prop("checked",!t.prop("checked"));n.prop("checked",!1),t.prop("checked",!t.prop("checked")),t.trigger("cms_checkall_toggle",{checked:e})}),n.on("click",function(){var t=n.is(":checked");$('[type="checkbox"]',i).each(function(){var e=$(this);e.attr("checked",t),e.trigger("cms_checkall_toggle",{checked:t})})})}},$.fn[i]=function(t){return this.each(function(){$.data(this,"plugin_"+i)||$.data(this,"plugin_"+i,new o(this,t))})}}(jQuery),function($){"use strict";$.widget("cmsms.cmsms_sortable_table",$.extend({},$.ui.sortable.prototype,{options:{actionurl:null,update:null,helper:null,callback:function(t){}},_create:function(){var t=this;return this.element.data("sortable",this.element.data("cmsms_sortable_table")),this.options.update=function(e,i){t._update(t.options,t.element)},this.options.helper=this._uiFixHelper,$.ui.sortable.prototype._create.apply(this,arguments)},_update:function(t,e){var i=t.actionurl,n=this.serialize($(e));$(e).find("tr:even").attr("class","row1"),$(e).find("tr:odd").attr("class","row2"),$.post(i+"&"+n,function(e){t.callback(e)})},serialize:function(t){var e=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},$(e).each(function(){var e=($(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);e&&i.push((t.key||e[1]+"[]")+"="+(t.key&&t.expression?e[1]:e[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},_uiFixHelper:function(t,e){return e.children().each(function(){$(this).width($(this).width())}),e}})),$.cmsms.cmsms_sortable_table.prototype.options=$.extend({},$.ui.sortable.prototype.options,$.cmsms.cmsms_sortable_table.prototype.options)}(jQuery),!cms_data)var cms_data={};if(cms_data=$.extend({},{alertfunc:null,dialogfunc:null,confirmfunc:null,notifyfunc:null,promptfunc:null,infonotices:null,successnotices:null,warnnotices:null,errornotices:null},cms_data),"undefined"==typeof cms_runtime&&(cms_runtime=!1),cms_runtime){var xvars,unscramble=function(t){var e,i,n=t.length,o=n-(1&n?0:1),s=[];for(e=0;e<n;e++)i=1&e?o+e:o-e-1,s[e]=t[i/2];return s.join("")},plain=unscramble(decodeURIComponent(cms_runtime));try{xvars=JSON.parse(plain)}catch(t){xvars={}}cms_data=$.extend({},cms_data,xvars||{})}function cms_lang(t,e){"use strict";return void 0!==cms_data[t="lang_"+t]?cms_data[t]:((void 0===e||e)&&cms_alert("lang key "+t+" not set"),"")}function cms_button_able(t,e){var i=void 0!==e&&!e;t instanceof jQuery||Array.isArray(t)||(t=[t]),$.each(t,function(t,e){e.disabled=i,i?e.classList.add("state-disabled"):e.classList.remove("state-disabled");var n=$(e);void 0!==n.button("instance")&&(i?n.button("disable"):n.button("enable"))})}function togglecollapse(t){"use strict";$("#"+t).toggle()}function activateHelp(t){var e=$(t).parent().data(),i=e.cmshelpKey;$.get(cms_data.ajax_help_url,{key:i},function(i){cms_help(t,e,i)})}function cms_help(t,e,i){var n=$(t).offset(),o=n.top-$(window).scrollTop(),s=n.left-$(window).scrollLeft();e.lasty=o,e.lastx=s;var c=cms_lang("title_help")+": "+e.cmshelpTitle;$.toast({text:i,heading:c,showHideTransition:"fade",hideAfter:0,loader:!1,position:{top:o,left:s},myclass:"info drag",closeicon:"",beforeShow:function(t){var i=$(t).find(".jqt-heading");function n(i){i=i||window.event,e.offy=i.clientY-e.lasty,e.offx=i.clientX-e.lastx,document.onmouseup=function(){document.onmouseup=null,document.onmousemove=null},document.onmousemove=function(i){var n=(i=i||window.event).clientY-e.offy,o=i.clientX-e.offx;(Math.abs(n-e.lasty)>2||Math.abs(o-e.lastx)>2)&&($(t).css({top:n,left:o}),e.lasty=n,e.lastx=o)}}i.length>0?i[0].onmousedown=n:t.onmousedown=n}})}function cms_dialog(t,e){"use strict";return void 0===e&&(e={}),"object"==typeof e&&null!==e&&void 0===e.closeText&&(e.closeText=cms_lang("close")),"function"!=typeof cms_data.dialogfunc?t.dialog(e):cms_data.dialogfunc(t,e)}function cms_prompt(t,e,i){"use strict";if(void 0!==t&&""!=t){if(void 0===e&&(e=""),void 0===i&&(i=""),"function"!=typeof cms_data.promptfunc){0===$("#cmsms_promptDialog").length&&$('<div id="cmsms_promptDialog" style="display:none;"></div>').insertAfter("body");var n='<h4 class="prompt">'+t+'</h4><input type="text" class="prompt" value="'+e+'" />',o=cms_lang("ok"),s=cms_lang("cancel"),c=$.Deferred();return $("#cmsms_promptDialog").html(n).dialog({modal:!0,title:i,width:"auto",buttons:[{text:o,icons:{primary:"ui-icon-check"},click:function(t){n=$("#cmsms_promptDialog input").val(),$(this).dialog("close"),n?c.resolve(n):c.reject(null)}},{text:s,icons:{primary:"ui-icon-close"},click:function(t){$(this).dialog("close"),c.reject(null)}}]}),c.promise()}return cms_data.promptfunc(t,e,i)}}function cms_alert(t,e){"use strict";if(void 0!==t&&""!=t){if(void 0!==e&&""!==e||(e=cms_lang("alert")),"function"!=typeof cms_data.alertfunc){0===$("#cmsms_errorDialog").length&&$('<div id="cmsms_errorDialog" style="display:none;"></div>').insertAfter("body");var i=$.Deferred(),n=cms_lang("close");return $("#cmsms_errorDialog").html(t).dialog({modal:!0,title:e,buttons:[{text:n,icons:{primary:"ui-icon-close"},click:function(t){$(this).dialog("close"),i.resolve()}}],close:function(t,e){i.resolve()}}),i.promise()}return cms_data.alertfunc(t,e)}}function cms_confirm(t,e,i,n){"use strict";if(void 0!==t&&""!=t){if(void 0!==e&&""!=e||(e=cms_lang("confirm")),void 0!==i&&""!=i||(i=cms_lang("ok")),void 0!==n&&""!=n||(n=cms_lang("cancel")),"function"!=typeof cms_data.confirmfunc){0===$("#cmsms_confirmDialog").length&&$('<div id="cmsms_confirmDialog" style="display:none;"></div>').insertAfter("body");var o=$.Deferred();return $("#cmsms_confirmDialog").html(t).dialog({modal:!0,title:e,buttons:[{text:i,icons:{primary:"ui-icon-check"},click:function(t){$(this).dialog("close"),o.resolve(i)}},{text:n,icons:{primary:"ui-icon-close"},click:function(t){$(this).dialog("close"),o.reject(n)}}]}),o.promise()}return cms_data.confirmfunc(t,e,i,n)}}function cms_confirm_btnclick(t,e,i,n,o){cms_confirm(e,i,n,o).done(function(){$(t).unbind("click").click()})}function cms_confirm_linkclick(t,e,i,n,o){cms_confirm(e,i,n,o).done(function(){window.location=$(t).attr("href")})}function cms_notify(t,e,i,n){"use strict";if(void 0===i&&(i=""),void 0===n&&(n={}),"function"!=typeof cms_data.notifyfunc){var o=$.extend({text:e,heading:i,showHideTransition:"fade",hideAfter:0,loader:!1,position:"top-center",myclass:t,icon:!0,closeicon:""},n);return $.toast(o)}return cms_data.notifyfunc(t,e,i,n)}function cms_notify_all(){"use strict";void 0!==cms_data.infonotices&&cms_data.infonotices&&cms_notify("info",cms_data.infonotices),void 0!==cms_data.successnotices&&cms_data.successnotices&&cms_notify("success",cms_data.successnotices),void 0!==cms_data.warnnotices&&cms_data.warnnotices&&cms_notify("warn",cms_data.warnnotices),void 0!==cms_data.errornotices&&cms_data.errornotices&&cms_notify("error",cms_data.errornotices)}function cms_busy(t){void 0===t&&(t=!0);var e=$("#cms_busy");if(!e.length){var i=$("<div/>").attr("id","cms_busy").addClass("busy").hide();$("body").append(i)}t?setTimeout(function(){e.show()},10):e.length&&e.hide()}function cms_equalHeight(t){var e,i=0;t.each(function(){(e=$(this).height())>i&&(i=e)}),t.height(i)}function cms_equalWidth(t){var e,i=0;t.each(function(){(e=$(this).width())>i&&(i=e)}),t.width(i)}String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.substr(e,t.length)===t});
