/*!
jQuery dirtyForm widget v.0.2
(C) 2014-2022 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL3+
*/
!function($,o,t,n){$.widget("cmsms.dirtyForm",{options:{unloadmsg:"",disabled:!1,dirty:!1,formClass:"dirtyForm",onDirty:null,beforeUnload:null,onUnload:null,unloadCancel:null},_create:function(){this.options.unloadmsg||(this.options.unloadmsg=cms_lang("confirm_leave"));var t=this;this.element.on("keyup",'input[type!="submit"], select, textarea',function(o){t.options.disabled||t.options.dirty||t._setOption("dirty",!0)}),this.element.on("change, cmsms_textchange",'input[type!="submit"], select, textarea',function(){t.options.disabled||t.options.dirty||t._setOption("dirty",!0)}),this.element.on("cmsms_formchange",function(o){t.options.disabled||t.options.dirty||t._setOption("dirty",!0)}),$(o).on("beforeunload",function(){var o,n;if(console.debug("dirtyform beforeunload"),!t.options.disabled)return(o=(n="function"==typeof t.options.beforeUnload?t.options.beforeUnload(t.options.dirty):null)&&n.length>0?n.trim():t.options.dirty?t.options.unloadmsg.trim():"")&&o.length>0?("function"==typeof t.options.unloadCancel&&setTimeout(function(){console.debug("in outer timer"),setTimeout(function(){console.debug("dirtyform unloadCancel"),t.options.unloadCancel()},1e3)},1),o):void 0}),$(o).on("unload",function(){t.options.disabled||(console.debug("dirtyform unload"),"function"==typeof t.options.onUnload&&t.options.onUnload(t.options.dirty))})},_setOption:function(o,t){if(this.options[o]=t,"disabled"==o&&(this.options.disabled=t),"dirty"==o)if(t){console.debug("dirtyform dirty = true");var n=this.element.find("form").addClass(this.options.formClass);this.options.dirty=!0,"function"==typeof this.options.onDirty&&this.options.onDirty(this,n)}else console.debug("dirtyform dirty = false"),this.options.dirty=!1,this.element.find("form").removeClass(this.options.formClass)}})}(jQuery,window,document);