tinymce.PluginManager.add("cmsms_filepicker",function(e){return e.settings.file_picker_type="file image media",e.settings.file_picker_callback=function(e,t,i){void 0!==top.filepicker&&alert("woot");var n,l,o;!function(e){n=e.innerHeight<650?Math.max(.8*e.innerHeight,250):600,l=e.innerWidth<950?Math.max(.8*e.innerWidth,250):900}(window);var r="i"+(new Date).getTime().toString(16);tinymce.activeEditor.dom.setAttrib(tinyMCE.activeEditor.dom.select("html"),"data-cmsfp-instance",r),top.document.CMSFileBrowser||(top.document.CMSFileBrowser={});top.document.CMSFileBrowser.onselect=function(t,n){function l(e){var t=substring(e.lastIndexOf("/")+1);return-1!=t.lastIndexOf(".")&&(t=t.substring(0,t.lastIndexOf("."))),t}n=cms_data.uploads_url+"/"+n;var r={};"file"==i.filetype?r.text=l(n):"image"==i.filetype&&(r.alt=l(n)),e(n,r),top.document.CMSFileBrowser.onselect=null,o.close()};var a=cmsms_tiny.filepicker_url+"&inst="+r+"&type="+i.filetype;o=tinymce.activeEditor.windowManager.open({title:cmsms_tiny.filepicker_title,file:a,classes:"filepicker",height:n,width:l,inline:1,resizable:!0,maximizable:!0},{onFileSelected:function(e){console.debug("woot got callback with "+e)}})},!1});