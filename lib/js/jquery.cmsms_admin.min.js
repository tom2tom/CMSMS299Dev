/*!
CMSMS admin functions
(C) 2014-2022 CMS Made Simple Foundation <foundation@cmsmadesimple.org>
License GPL3+
*/
var CMSMS_Admin=CMSMS_Admin||{};if(function(t,i){"use strict";for(var e,n=function(){},o=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],s=o.length,c=t.console=t.console||{};s--;)c[e=o[s]]||(c[e]=n);this.namespace=function(t){var e,n,o,s=t.split("."),c=CMSMS_Admin;for(s[0]===i&&(s=s.slice(1)),e=0,n=s.length;e<n;e++)void 0===c[o=s[e]]&&(c[o]={}),c=c[o];return c}}.call(CMSMS_Admin,window,"CMSMS_Admin"),function($){"use strict";var t=CMSMS_Admin.namespace("Helper");t.cms_uploadLimit=function(){$("form").on("submit",function(t){if(!$(this).attr("novalidate")){var i=$('input[type="file"]',this);if(0!==i.length){var e=0;return i.each(function(t,i){0!==i.files.length&&(e+=i.files[0].size)}),void 0!==cms_data&&void 0!==cms_data.max_upload_size&&cms_data.max_upload_size>0&&e>cms_data.max_upload_size?(cms_alert(cms_lang("largeupload")),!1):void 0}}})},t.cms_resizableTextArea=function(){var t=document.createElement("textarea");$("textarea").each(function(){var i=$(this);void 0!==t.style.resize&&!i.hasClass("cms_resizable")||i.hasClass("MicroTiny")||i.hasClass("no-resize")||i.resizable({handles:"se",ghost:!0})})},t.cms_helpDialog=function(){$(".cms_help .cms_helpicon").on("click",function(){activateHelp(this)})},t.cms_initTabs=function(){function t(t){var i=$("#navt_tabs");0===i.length&&(i=$("#page_tabs")),i.find("div").eq(t).trigger("mousedown")}var i=$("#navt_tabs, #page_tabs").find("div");i.on("mousedown",function(){var t=$(this);return i.each(function(){var t=$(this);t.removeClass("active"),$("#"+t.attr("id")+"_c").hide()}),t.addClass("active"),$("#"+t.attr("id")+"_c").show(),!0}),i.on("focus",function(t){$(this).addClass("focus")}),i.on("blur",function(t){$(this).removeClass("focus")}),i.on("keyup",function(e){e.keyCode==$.ui.keyCode.ENTER&&t(i.index(this))}),i.attr("tabindex","0"),0===i.filter(".active").mousedown().length&&t(0)},t.cms_initModalDialog=function(){var t={};$(".dialog").each(function(){var i=$(this),e=$(this).prev(".open").attr("title");t[e]=cms_dialog(i,{autoOpen:!1,modal:!0})}),$(".open").on("click",function(i){i.preventDefault();var e=$(this).attr("title");return t[e].dialog("open").removeClass("invisible"),!1})},t.cms_initTooltips=function(){$(".tooltip").tooltip({items:"[title], [data-cms-description], [data-cms-ajax]",content:function(t){var i,e=$(this),n=e.data();return e.is("[data-cms-description]")?n.cmsDescription:e.is("[data-cms-ajax]")?(i=n.cmsAjax+"&"+cms_data.job_key+"=1",$.ajax(i,{dataType:"html"}).fail(function(t,i,e){console.debug("Request error: "+i+" "+e)}).done(function(i){t(i)})):e.is("[title]")?e.attr("title"):void 0}})},t.cms_jquiMarkup=function(){$("[data-jqui]").each(function(t,i){var e=$(i).data();$.each(e.jqui.split(/\s+/),function(t,n){$(i)[n](e)})})};var i=CMSMS_Admin.namespace("Loader");i.reload=function(){},i.init=function(){i.reload(),t.cms_resizableTextArea(),t.cms_helpDialog(),t.cms_initTabs(),t.cms_initModalDialog(),t.cms_initTooltips(),t.cms_uploadLimit()},$(function(){i.init(),$(document).on("cms_ajax_apply",function(t){cms_notify("Success"===t.response?"success":"error",t.details)})});var e="cmsms_checkall",n={target:"table"};function o(t,i){this.element=t,this.settings=$.extend({},n,i),this.defaults=n,this._name=e,this.init()}o.prototype={init:function(){this._toggle(this.element,this.settings.target)},_toggle:function(t,i){var e=$(t).closest(i),n=$(t);$('[type="checkbox"]',e).not(n).on("click",function(){var t=$(this),i=t.prop("checked",!t.prop("checked"));n.prop("checked",!1),t.prop("checked",!t.prop("checked")),t.trigger("cms_checkall_toggle",{checked:i})}),n.on("click",function(){var t=n.is(":checked");$('[type="checkbox"]',e).each(function(){var i=$(this);i.attr("checked",t),i.trigger("cms_checkall_toggle",{checked:t})})})}},$.fn[e]=function(t){return this.each(function(){$.data(this,"plugin_"+e)||$.data(this,"plugin_"+e,new o(this,t))})}}(jQuery),function($){"use strict";$.widget("cmsms.cmsms_sortable_table",$.extend({},$.ui.sortable.prototype,{options:{actionurl:null,update:null,helper:null,callback:function(t){}},_create:function(){var t=this;return this.element.data("sortable",this.element.data("cmsms_sortable_table")),this.options.update=function(i,e){t._update(t.options,t.element)},this.options.helper=this._uiFixHelper,$.ui.sortable.prototype._create.apply(this,arguments)},_update:function(t,i){var e=t.actionurl,n=this.serialize($(i));$(i).find("tr").even().attr("class","row1"),$(i).find("tr").odd().attr("class","row2"),$.post(e+"&"+n,function(i){t.callback(i)})},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),e=[];return t=t||{},$(i).each(function(){var i=($(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&e.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!e.length&&t.key&&e.push(t.key+"="),e.join("&")},_uiFixHelper:function(t,i){return i.children().each(function(){$(this).width($(this).width())}),i}})),$.cmsms.cmsms_sortable_table.prototype.options=$.extend({},$.ui.sortable.prototype.options,$.cmsms.cmsms_sortable_table.prototype.options)}(jQuery),void 0===cms_data)var cms_data={};else cms_data||(cms_data={});if(cms_data=$.extend({},{alertfunc:null,dialogfunc:null,confirmfunc:null,notifyfunc:null,promptfunc:null,infonotices:null,successnotices:null,warnnotices:null,errornotices:null},cms_data),void 0===cms_runtime)var cms_runtime=!1;if(cms_runtime){var xvars,unscramble=function(t){var i,e,n=t.length,o=n-(1&n?0:1),s=[];for(i=0;i<n;i++)e=1&i?o+i:o-i-1,s[i]=t[e/2];return s.join("")},plain=unscramble(decodeURIComponent(cms_runtime));try{xvars=JSON.parse(plain)}catch(t){xvars={}}cms_data=$.extend({},cms_data,xvars||{})}function cms_lang(t,i){"use strict";return void 0!==cms_data[t="lang_"+t]?cms_data[t]:((void 0===i||i)&&cms_alert("Translation for '"+t+"' not set"),"")}function cms_button_able(t,i){var e=void 0!==i&&!i;t instanceof $||Array.isArray(t)||(t=[t]),$.each(t,function(t,i){i.disabled=e,e?i.classList.add("state-disabled"):i.classList.remove("state-disabled");var n=$(i);void 0!==n.button("instance")&&(e?n.button("disable"):n.button("enable"))})}function togglecollapse(t){"use strict";$("#"+t).toggle()}function activateHelp(t){var i=$(t).parent().data(),e=i.cmshelpKey;$.get(cms_data.ajax_help_url,{key:e},function(e){cms_help(t,i,e)})}function cms_help(t,i,e){var n=$(t).offset(),o=n.top-$(window).scrollTop(),s=n.left-$(window).scrollLeft();i.lasty=o,i.lastx=s;var c=cms_lang("title_help")+": "+i.cmshelpTitle;$.toast({text:e,heading:c,showHideTransition:"fade",hideAfter:0,loader:!1,position:{top:o,left:s},myclass:"info drag",closeicon:"",beforeShow:function(t){var e=$(t).find(".jqt-heading");function n(e){e=e||window.event,i.offy=e.clientY-i.lasty,i.offx=e.clientX-i.lastx,document.onmouseup=function(){document.onmouseup=null,document.onmousemove=null},document.onmousemove=function(e){var n=(e=e||window.event).clientY-i.offy,o=e.clientX-i.offx;(Math.abs(n-i.lasty)>2||Math.abs(o-i.lastx)>2)&&($(t).css({top:n,left:o}),i.lasty=n,i.lastx=o)}}e.length>0?e[0].onmousedown=n:t.onmousedown=n}})}function cms_dialog(t,i){"use strict";return void 0===i&&(i={}),"object"==typeof i&&null!==i&&void 0===i.closeText&&(i.closeText=cms_lang("close")),"function"!=typeof cms_data.dialogfunc?t.dialog(i):cms_data.dialogfunc(t,i)}function cms_prompt(t,i,e){"use strict";if(void 0!==t&&""!==t){if(void 0===i&&(i=""),void 0===e&&(e=""),"function"!=typeof cms_data.promptfunc){0===$("#cmsms_promptDialog").length&&$('<div id="cmsms_promptDialog" style="display:none;"></div>').insertAfter("body");var n='<h4 class="prompt">'+t+'</h4><input type="text" class="prompt" value="'+i+'" />',o=cms_lang("ok"),s=cms_lang("cancel"),c=$.Deferred();return $("#cmsms_promptDialog").html(n).dialog({modal:!0,title:e,width:"auto",buttons:[{text:o,icons:{primary:"ui-icon-check"},click:function(t){n=$("#cmsms_promptDialog input").val(),$(this).dialog("close"),n?c.resolve(n):c.reject(null)}},{text:s,icons:{primary:"ui-icon-close"},click:function(t){$(this).dialog("close"),c.reject(null)}}]}),c.promise()}return cms_data.promptfunc(t,i,e)}}function cms_alert(t,i,e){"use strict";if(void 0!==t&&""!==t){if(i||(i=cms_lang("alert")),void 0===e&&(e=!1),"function"!=typeof cms_data.alertfunc){0===$("#cmsms_errorDialog").length&&$('<div id="cmsms_errorDialog" style="display:none;"></div>').insertAfter("body");var n,o=cms_lang("close");return n=!!e&&$.Deferred(),$("#cmsms_errorDialog").html(t).dialog({modal:!0,title:i,buttons:[{text:o,icons:{primary:"ui-icon-close"},click:function(){$(this).dialog("close"),n&&n.resolve()}}],close:function(){n&&n.resolve()}}),n?n.promise():void 0}if(e)return cms_data.alertfunc(t,i,!0);cms_data.alertfunc(t,i,!1)}}function cms_confirm(t,i,e,n){"use strict";if(void 0!==t&&""!==t){if(i||(i=cms_lang("confirm")),e||(e=cms_lang("ok")),n||(n=cms_lang("cancel")),"function"!=typeof cms_data.confirmfunc){0===$("#cmsms_confirmDialog").length&&$('<div id="cmsms_confirmDialog" style="display:none;"></div>').insertAfter("body");var o=$.Deferred();return $("#cmsms_confirmDialog").html(t).dialog({modal:!0,title:i,buttons:[{text:e,icons:{primary:"ui-icon-check"},click:function(){$(this).dialog("close"),o.resolve(e)}},{text:n,icons:{primary:"ui-icon-close"},click:function(){$(this).dialog("close"),o.reject(n)}}]}),o.promise()}return cms_data.confirmfunc(t,i,e,n)}}function cms_confirm_btnclick(t,i,e,n,o){cms_confirm(i,e,n,o).done(function(){$(t).off("click").trigger("click")})}function cms_confirm_linkclick(t,i,e,n,o){cms_confirm(i,e,n,o).done(function(){window.location=$(t).attr("href")})}function cms_notify(t,i,e,n){"use strict";if(void 0!==i&&""!==i){if(void 0===e&&(e=""),void 0===n&&(n={}),"function"!=typeof cms_data.notifyfunc){var o=$.extend({text:i,heading:e,showHideTransition:"fade",hideAfter:0,loader:!1,position:"top-center",myclass:t,icon:!0,closeicon:""},n);return $.toast(o)}return cms_data.notifyfunc(t,i,e,n)}}function cms_notify_all(){"use strict";void 0!==cms_data.infonotices&&cms_data.infonotices&&cms_notify("info",cms_data.infonotices),void 0!==cms_data.successnotices&&cms_data.successnotices&&cms_notify("success",cms_data.successnotices),void 0!==cms_data.warnnotices&&cms_data.warnnotices&&cms_notify("warn",cms_data.warnnotices),void 0!==cms_data.errornotices&&cms_data.errornotices&&cms_notify("error",cms_data.errornotices)}function cms_busy(t){var i=$("#cms_busy");0===i.length&&(i=$("<div>").attr("id","cms_busy").addClass("busy").hide().appendTo($("body"))),void 0===t||t?setTimeout(function(){i.show()},10):i.length&&i.hide()}function cms_equalHeight(t){var i,e=0;t.each(function(){(i=$(this).height())>e&&(e=i)}),t.height(e)}function cms_equalWidth(t){var i,e=0;t.each(function(){(i=$(this).width())>e&&(e=i)}),t.width(e)}String.prototype.startsWith||(String.prototype.startsWith=function(t,i){return i=i||0,this.substr(i,t.length)===t});
